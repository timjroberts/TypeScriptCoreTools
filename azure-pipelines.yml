# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

name: $(version.major).$(version.minor).$(version.patch)-alpha$(buildcount)

variables:
  MajorVersion: $(version.major)
  MinorVersion: $(version.minor)
  PatchVersion: $(version.patch)
  BuildCount: $[counter('buildcount', 5)]
  NugetKey: $(key.nuget)

jobs:
- job: InstallPrereqs
  displayName: 'Install Build Pre-requisites'
  steps:
  - task: DotNetCoreInstaller@0
    inputs:
      packageType: 'sdk'
      version: '2.1.403'

- job: Build
  dependsOn: InstallPrereqs
  displayName: 'Build and Publish TypeScript Core Tools'
  steps:
  - script: dotnet msbuild build/build.proj /p:MajorVersion=$MAJORVERSION /p:MinorVersion=$MINORVERSION /p:PatchVersion=$PATCHVERSION /p:VersionSuffix=alpha$BUILDCOUNT /p:NuGetApiKey=$NUGETKEY
    displayName: 'Build and Publish'
    env:
      NUGETKEY: $(NugetKey)
